<!DOCTYPE html>
<html>
<head>
    <title>HARD CYCLE - Home</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">HARD CYCLE</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">About Us</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Market Place</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Donation</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="community-info.html" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Communities 
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                    <li><a class="dropdown-item" href="community-info.html">About Support Community </a></li>
                    <li><a class="dropdown-item" href="community-guides.html">How to Earn Points</a></li>
                    <li><a class="dropdown-item" href="forum-landingpg.html">HARD CYCLE's Community</a></li>               
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>

    <header>
        <h1>Welcome to HARD CYCLE's Forum</h1>
        <p>Join the conversation, ask questions, and share your expertise.</p>
    </header>

    <main>
      <div class="container">
          <div class="row">
              <div class="col-9">
                  <h1>Reply to Question</h1>
              </div>
              <div class="col-3 text-end">
                  <a href="forum-landingpg.html" class="btn btn-primary">All Questions</a>
              </div>
          </div>
          <div id="question-details" class="card border-light mb-3">
            <div class="card-body">
              <h5 class="card-title" id="question-title">Question-Title</h5>
              <h6 class="card-subtitle mb-2 text-body-secondary" id="question-category">Product Category</h6>
              <p class="card-text" id="question-content">Question Content: Some quick example text to build on the card title and make up the bulk of the card's content.</p>
            </div>
          </div>

          <div class="row">
              <h2>Responses</h2>
              <div id="all_responses">
                  <!-- Responses will be displayed here -->
              </div>
          </div>
          <div class="row">
              <form id="response-form">
                  <label for="response">Your Response:</label><br>
                  <textarea class="form-control" id="your_response" rows="4"></textarea>
                  <div class="col-12 mt-3">
                      <button type="submit" class="btn btn-primary">Submit</button>
                  </div>
              </form>
          </div>
      </div>

      <script>
          const firebaseConfig = {
              apiKey: "YOUR_API_KEY",
              authDomain: "YOUR_AUTH_DOMAIN",
              projectId: "YOUR_PROJECT_ID",
              storageBucket: "YOUR_STORAGE_BUCKET",
              messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
              appId: "YOUR_APP_ID"
          };

          // Initialize Firebase
          firebase.initializeApp(firebaseConfig);
          const firestore = firebase.firestore();

          const urlParams = new URLSearchParams(window.location.search);
          const title = urlParams.get("title");
          const category = urlParams.get("category");
          const content = urlParams.get("content");

          const questionTitle = document.getElementById("question-title");
          const questionCategory = document.getElementById("question-category");
          const questionContent = document.getElementById("question-content");

          questionTitle.textContent = title;
          questionCategory.textContent = category;
          questionContent.textContent = content;

          const responseForm = document.getElementById("response-form");
          const responseTextarea = document.getElementById("your_response");
          const responsesContainer = document.getElementById("all_responses");

          // Add an event listener to the response form
          responseForm.addEventListener('submit', (e) => {
              e.preventDefault();

              // Get the user's response from the form
              const userResponse = responseTextarea.value;

              // Save the response to Firebase Firestore
              // Replace "all_responses" with your Firestore collection name
              firestore.collection('all_responses').add({
                  questionTitle: title,
                  response: userResponse,
              })
              .then(() => {
                  // Award points for the response
                  awardPointsForResponse(userId); // Pass the user's ID for points calculation

                  // Clear the response textarea
                  responseTextarea.value = '';

                  // Refresh the responses display (you can also use real-time updates)
                  displayResponses(title);
              })
              .catch((error) => {
                  console.error('Error saving response:', error);
              });
          });


          // Function to display responses
          function displayResponses(questionTitle) {
              responsesContainer.innerHTML = ""; // Clear previous responses

              // Query Firestore for responses associated with the question title
              firestore.collection("all_responses")
                  .where("questionTitle", "==", questionTitle)
                  .get()
                  .then((querySnapshot) => {
                      querySnapshot.forEach((doc) => {
                          const data = doc.data();
                          const responseText = data.response;

                          // Create a response element
                          const responseElement = document.createElement("div");
                          responseElement.textContent = responseText;

                          // Append the response to the responses container
                          responsesContainer.appendChild(responseElement);
                      });
                  })
                  .catch((error) => {
                      console.error("Error fetching responses:", error);
                  });
          }

          // Initial display of responses
          displayResponses(title);


          // Function to calculate and award points for a response
          function awardPointsForResponse(userId) {
              const pointsAwarded = 20; // Points awarded for each response

              // Fetch the user's current points from Firestore
              const usersCollection = firestore.collection('users'); // Replace with your user collection name
              const userDoc = usersCollection.doc(userId);

              userDoc.get()
                  .then((userSnapshot) => {
                      if (userSnapshot.exists) {
                          const userData = userSnapshot.data();
                          let currentPoints = userData.points || 0; // Default to 0 if points field doesn't exist

                          // Award points for the response
                          currentPoints += pointsAwarded;

                          // Update the user's points in Firestore
                          return userDoc.update({ points: currentPoints });
                      } else {
                          console.error('User document not found');
                      }
                  })
                  .catch((error) => {
                      console.error('Error fetching user data:', error);
                  });
          }

      </script>
  </main>



    <footer>
        <p>&copy; 2023 HARD CYCLE</p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    

</body>
</html>
